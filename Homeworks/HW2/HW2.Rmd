---
title: "HW2"
author: "Noah Love"
date: "1/29/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# HW2 - Simple Data Mining

This homework is to meant for you to do some basic data mining tasks using
statistics from your prior classes.

### Context - US's winner takes all voting system

Most of the voting in the US takes the form of "winner-takes-all" which encourages
the formation of a two party system. We will see if we can identify the party affiliations
simply by looking at the voting patterns.

We've collected data from the [senate.gov](https://www.senate.gov/legislative/LIS/roll_call_lists/vote_menu_117_1.htm)

#### Q1 Data wrangling of the Senate Voting
In `votes.json`, you will find the Senate voting records from the 105th to 115th Senate.
The file is organized by senators, each with an id encoded by `S` followed by a digit. For each senator,
their voting record for the last version of the bill is recorded, `1` stands for "Yea", `-1`
stands for "Nay", `0` stands for "Not voting", and `-9999` is used if there were issues during
data collection. The bills are labeled with the congress term (e.g. `106`), the session number (e.g. `1` or `2`),
then the issue ID.

Please wrangle this dataset into a matrix called `voting_matrix` so we can calculate the correlation between the senators'
voting behavior, i.e. we will run `cor(voting_matrix, ...)` in Q3 to identify how senators' vote with one another.

Please report the dimensions of your matrix and what percentage of the matrix does not contain `-1`, `1`, or `0`. For
example, if I only have 2 senators and 2 bills where one out of the four terms is not `-1`, `1`, or `0`, then I would
report `25%`.
- I'm intentionally not telling you what are the columns and what are the rows, this should be implied.



### My Work
```{r, include=FALSE}


votes <- jsonlite::fromJSON('votes.json')
voters <- jsonlite::fromJSON("voters.json")

length(names(votes))

#names(voting) #displays all the senators in the file
# votes.tibble <- tibble()
# 
# votes.tibble <- as_tibble(votes)
# votes.tibble

#head(senator_codes)
```


```{r}
votes1 <- lapply(votes, function(x) {
  x[sapply(x, is.null)] <- NA
  unlist(x)
})

df <- as.data.frame(do.call("cbind",votes1))

library(DT)

datatable(head(df))
```




```{r}
# {"S238": {"105_1_H.R. 1003_00044": 1, "105_1_H.R. 1119_00296": 1, "105_1_H.R. 1122_00071": 1, "105_1_H.R. 1469_00095": 1, "105_1_H.R. 1757_00105": 1, "105_1_H.R. 1871_00100": -1, "105_1_H.R. 2014_00211": 1, "105_1_H.R. 2015_00209": 1, "105_1_H.R. 2016_00240": 1, "105_1_H.R. 2107_00283": 1, "105_1_H.R. 2158_00194": 1, "105_1_H.R. 2160_00212": -1, "105_1_H.R. 2169_00208": 1, "105_1_H.R. 2203_00262": 1, "105_1_H.R. 2209_00257": 1, "105_1_H.R. 2264_00298": 1, "105_1_H.R. 2266_00258": 1, "105_1_H.R. 2378_00264": -1, "105_1_H.R. 2646_00291": 1, "105_1_H.R. 5_00066": 1, "105_1_S. 1004_00179": 1, "105_1_S. 1005_00176": 1, "105_1_S. 1022_00206": 1, "105_1_S. 1023_00191": 1, "105_1_S. 1033_00201": 1, "105_1_S. 1034_00193": -1, "105_1_S. 104_00042": 1, "105_1_S. 1061_00235": 1, "105_1_S. 1156_00269": 1, "105_1_S. 1173_00282": 1, "105_1_S. 1269_00294": 1, "105_1_S. 1292_00287": -1, "105_1_S. 25_00274": 1, "105_1_S. 39_00207": 1, "105_1_S. 4_00094": 1, "105_1_S. 495_00045": 1, "105_1_S. 522_00043": 1, "105_1_S. 543_00055": 1, "105_1_S. 672_00063": 1, "105_1_S. 717_00065": 1, "105_1_S. 830_00256": 1, "105_1_S. 858_00109": 1, "105_1_S. 903_00104": -1, "105_1_S. 923_00106": 1, "105_1_S. 936_00173": 1, "105_1_S. 947_00130": 1, "105_1_S. 949_00159": 1, "105_1_S. 955_00185": 1, "105_2_H.R. 10_00301": 1, "105_2_H.R. 1122_00277": 1, "105_2_H.R. 1151_00239": 1, "105_2_H.R. 1270_00148": 1, "105_2_H.R. 1273_00127": 1, "105_2_H.R. 1385_00119": 1, "105_2_H.R. 1757_00105": 1, "105_2_H.R. 2400_00147": 1, "105_2_H.R. 2431_00310": 1, "105_2_H.R. 2631_00013": -1, "105_2_H.R. 2646_00169": 1, "105_2_H.R. 2676_00189": 1, "105_2_H.R. 2709_00146": 1, "105_2_H.R. 3150_00313": 1, "105_2_H.R. 3579_00118": 1, "105_2_H.R. 3616_00293": 1, "105_2_H.R. 4057_00288": 1, "105_2_H.R. 4059_00253": 1, "105_2_H.R. 4101_00298": 1, "105_2_H.R. 4103_00291": 1, "105_2_H.R. 4104_00312": 1, "105_2_H.R. 4112_00214": 1, "105_2_H.R. 4194_00307": 1, "105_2_H.R. 4250_00311": 1, "105_2_H.R. 4328_00314": 1, "105_2_H.R. 6_00290": 1, "105_2_H.R. 629_00255": 1, "105_2_S. 1092_00294": -1, "105_2_S. 1150_00129": 1, "105_2_S. 1173_00030": 1, "105_2_S. 1244_00132": 1, "105_2_S. 1260_00135": 1, "105_2_S. 1301_00283": 1, "105_2_S. 1415_00162": -1, "105_2_S. 1575_00007": 1, "105_2_S. 1601_00010": 1, "105_2_S. 1618_00130": 1, "105_2_S. 1645_00282": 1, "105_2_S. 1663_00017": 1, "105_2_S. 1668_00024": 1, "105_2_S. 1723_00141": 1, "105_2_S. 1768_00045": 1, "105_2_S. 1873_00262": 1, "105_2_S. 1882_00194": -1, "105_2_S. 1981_00266": 1, "105_2_S. 2037_00137": 1, "105_2_S. 2057_00181": 1, "105_2_S. 2132_00251": 1, "105_2_S. 2138_00165": 1, "105_2_S. 2159_00208": -1, "105_2_S. 2168_00212": -1, "105_2_S. 2176_00289": 1, "105_2_S. 2237_00269": 1, "105_2_S. 2260_00234": 1, "105_2_S. 2271_00197": 1, "105_2_S. 2279_00287": 1, "105_2_S. 2282_00190": 1, "105_2_S. 2307_00235": 1, "105_2_S. 2312_00246": -1, "105_2_S. 2334_00259": 1, "105_2_S. 414_00085": 1, "105_2_S. 442_00308": 1, "105_2_S. 648_00188": 1, "106_1_H.R. 1141_00136": 1, "106_1_H.R. 1180_00372": 1, "106_1_H.R. 1259_00170": 1, "106_1_H.R. 1376_00087": 1, "106_1_H.R. 1501_00224": 1, "106_1_H.R. 1555_00216": 1, "106_1_H.R. 1664_00176": 1, "106_1_H.R. 1905_00173": 1, "106_1_H.R. 1906_00323": 1, "106_1_H.R. 2084_00306": 1, "106_1_H.R. 2466_00291": 1, "106_1_H.R. 2488_00261": 1, "106_1_H.R. 2490_00277": -1, "106_1_H.R. 2561_00326": 1, "106_1_H.R. 2587_00279": 1, "106_1_H.R. 2605_00295": 1, "106_1_H.R. 2606_00312": 1, "106_1_H.R. 2684_00328": 1, "106_1_H.R. 3064_00343": -1, "106_1_H.R. 3194_00374": 1, "106_1_H.R. 434_00353": 1, "106_1_H.R. 775_00196": 1, "106_1_H.R. 800_00089": 1, "106_1_H.R. 975_00178": -1, "106_1_S. 1059_00284": 1, "106_1_S. 1122_00158": 1, "106_1_S. 1143_00185": 1, "106_1_S. 1186_00172": 1, "106_1_S. 1205_00168": 1, "106_1_S. 1217_00220": -1, "106_1_S. 1233_00258": 1, "106_1_S. 1234_00192": 1, "106_1_S. 1282_00197": -1, "106_1_S. 1344_00210": 1, "106_1_S. 1429_00247": 1, "106_1_S. 1593_00331": -1, "106_1_S. 1650_00321": 1, "106_1_S. 1692_00340": 1, "106_1_S. 254_00140": 1, "106_1_S. 257_00051": 1, "106_1_S. 280_00047": 1, "106_1_S. 314_00028": 1, "106_1_S. 331_00169": 1, "106_1_S. 335_00248": 1, "106_1_S. 4_00026": 1, "106_1_S. 531_00088": 1, "106_1_S. 544_00056": -1, "106_1_S. 557_00211": 1, "106_1_S. 625_00368": 1, "106_1_S. 643_00052": 1, "106_1_S. 82_00311": -1, "106_1_S. 886_00180": 1, "106_1_S. 900_00354": 1, "106_1_S. 96_00164": 1, "106_2_H.R. 1000_00035": 1, "106_2_H.R. 1883_00012": 1, "106_2_H.R. 2415_00297": 1, "106_2_H.R. 2559_00115": 1, "106_2_H.R. 2614_00286": 1, "106_2_H.R. 3244_00269": 1, "106_2_H.R. 4205_00275": 1, "106_2_H.R. 434_00098": 1, "106_2_H.R. 4425_00106": 1, "106_2_H.R. 4444_00251": 1, "106_2_H.R. 4461_00277": 1, "106_2_H.R. 4475_00267": 1, "106_2_H.R. 4516_00273": -1, "106_2_H.R. 4576_00230": 1, "106_2_H.R. 4577_00171": 1, "106_2_H.R. 4578_00266": 1, "106_2_H.R. 4635_00278": 1, "106_2_H.R. 4733_00261": 1, "106_2_H.R. 4762_00160": 1, "106_2_H.R. 4810_00226": 1, "106_2_H.R. 4811_00280": 1, "106_2_H.R. 4871_00227": 1, "106_2_H.R. 4942_00289": 1, "106_2_H.R. 5_00042": 1, "106_2_H.R. 6_00087": 1, "106_2_H.R. 782_00285": 1, "106_2_H.R. 8_00197": 1, "106_2_H.R. 833_00005": 1, "106_2_S. 1134_00033": 1, "106_2_S. 1287_00088": 1, "106_2_S. 2_00095": -1, "106_2_S. 2045_00262": 1, "106_2_S. 2097_00050": 1, "106_2_S. 2251_00043": 1, "106_2_S. 2285_00080": 1, "106_2_S. 2323_00081": 1, "106_2_S. 2507_00228": 1, "106_2_S. 2508_00282": 1, "106_2_S. 2521_00105": 1, "106_2_S. 2522_00141": 1, "106_2_S. 2549_00178": 1, "106_2_S. 2603_00114": 1, "106_2_S. 2796_00255": 1, "106_2_S. 625_00004": -1, "106_2_S. 761_00133": 1}
```



















#### Q2 Expectations
Please articulate your expectations for the correlation matrix given the 2 party system.
- What's its dimension?
- How many modes do you expect to see in the distribution of correlation values?
- Where will the correlation values center?

#### Q3 Mining with correlations
Please calculate the correlation value between the senators' voting pattern, please set `use=pairwise.complete.obs`
in the function `cor()`.

- Please explain why R will warn you that some correlations cannot be computed.
- Please plot the histogram of the lower triangular values within the correlation matrix. Hint: `lower.tri`
    - Please comment on this histogram relative to your expectations from Q2. Side comment: make sure this makes sense to you!
- Please re-order the correlataion matrix such that it starts with the highest positive correlation (1) to the strongest
  negative correlation (-1) with respect to Senator McConnell's votes, i.e. the previous Senate majority leader who has
  served since 1985 (id=`S174`, member of the Republican Party). Note that the [majority leader](https://www.senate.gov/artandhistory/history/common/briefing/Majority_Minority_Leaders.htm) is the party's spokesperson for the party's position on issues.
  - It would make sense to filter out senators who do not overlap Senator McConnell.
  - Please try to visualize this re-ordered correlation matrix, hint: `image()`
- Please list the senators, if any, who have a negative correlation with Senator McConnell's votes but an **average** greater than
  0.2 correlation with the "possible Republicans".
  - We will define a 'possible Republican' as someone with a correlation of 0.2 or higher voting record with Senator McConnell.
  - You will need the file `voters.json` to get the names of these senators.
- Why might this group be interesting if they exist? This will **not be graded** by the grader but your projects
  will require you to make this kind of articulation. This should be done in 5 or fewer sentences.

#### Q4 Machine learning intuition with regression
We will compare 2 feature selection methods for regression, with the goal of predicting a senator's voting pattern.
In both methods, for any target senator, we will select 2 other senators to predict their vote on any issue.
- Method 1:
  - Pick the senators with the strongest positive and strongest negative correlation with the chosen senator.
  - Run OLS against both senators simultaneously.
- Method 2:
  - To identify the first senator, simply find the one senator with the strongest correlation.
  - Run OLS of the target senator against the first senator and obtain the residuals.
  - Identify the second senator by identifying the senator whose voting record has the strongest correlation with the residuals from above.
  - Re-run OLS against both senator simultaneously.

Please answer the following:
- Why isn't choosing the 2 senators with the 2 strongest positive correlations a reasonable strategy? This should be 3 or fewer sentences.
- What does `lm()` do when one senator has no voting record for a particular bill? Is the behavior different if the senator is the independent or dependent variable?
- For each senator, please randomly choose 20% of their bills data into a test set, then use the remaining 80% of bills to run both methods above. Please report which method has a better prediction performance according to what you see?
    - Do not impute the missing values
    - You should choose a prediction metric
    - This is not a full cross validation because we are not rotating the test set.
    - Please visualize the prediction performance across senators for both methods.

Side comment: For data mining purposes, one might look into the existence of a popular predictive senator!


{% include lib/mathjax.html %}
